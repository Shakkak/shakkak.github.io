{{/* Hugo Blox: Skills */}}
{{/* Documentation: https://hugoblox.com/blocks/ */}}
{{/* License: https://github.com/HugoBlox/hugo-blox-builder/blob/main/LICENSE.md */}}

{{/* Initialise */}}
{{ $page := .wcPage }}
{{ $block := .wcBlock }}
{{ $author := $block.content.username | default "admin" }}

{{/* Attempt to get the author's page where skills are defined */}}
{{ $person_page_path := (printf "/authors/%s" $author) }}
{{ $person_page := site.GetPage $person_page_path }}

{{/* --- Start of Renderable HTML --- */}}
{{/* We only render the section if the author page and skills exist */}}
{{ if and $person_page $person_page.Params.skills }}
  {{ $skills := $person_page.Params.skills }}

  <div class="col-12">
    {{ with $block.content.text }}
      <div class="col-md-12 text-center mb-3">
        {{ . | emojify | $page.RenderString }}
      </div>
    {{ end }}

    <div class="skills-container">

      {{/* --- ROW 1: SKILL GROUP TITLES --- */}}
      <div class="row">
        {{ range $skills }}
          <div class="col-12 col-md-4">
            <div class="skill-group-title">
              {{ .name | markdownify | emojify }}
              {{ with .description }}<p>{{ . | markdownify | emojify }}</p>{{ end }}
            </div>
          </div>
        {{ end }}
      </div>

      {{/* --- ROW 2: SKILL ITEMS --- */}}
      <div class="row">
        {{ range $skills }}
          <div class="col-12 col-md-4">
            {{/* Loop through the items for this skill group */}}
            {{ range .items }}
              {{ $pack := or .icon_pack "fas" }}
              {{ $pack_prefix := $pack }}
              {{ if in (slice "fab" "fas" "far" "fal") $pack }}
                {{ $pack_prefix = "fa" }}
              {{ end }}

              <div class="skills-content">
                {{ with .icon }}
                  <span class="skills-icon">
                    {{- if eq $pack "emoji" -}}
                      {{- . | emojify -}}
                    {{- else if eq $pack "custom" -}}
                      {{- $svg_icon := resources.Get (printf "media/icons/%s.svg" .) -}}
                      {{- if $svg_icon -}}<img src="{{ $svg_icon.RelPermalink }}" alt="{{.}}" class="svg-icon svg-baseline" loading="lazy">{{- end -}}
                    {{- else -}}
                      <i class="{{ $pack }} {{ $pack_prefix }}-{{ . }}"></i>
                    {{- end -}}
                  </span>
                {{ end }}

                <span class="skills-name">
                  {{ .name | markdownify | emojify }}
                  {{ with .description }}<p class="skills-description">{{ . | markdownify | emojify }}</p>{{ end }}
                </span>
              </div>
            {{ end }}
          </div>
        {{ end }}
      </div>

    </div>
  </div>
{{ else }}
  {{/* This will print an error in your TERMINAL if skills data cannot be found. */}}
  {{ warnf "Skills block: Could not find skills for author '%s'. Check 'username' in your skills widget file and ensure the author page exists at 'content/authors/%s'." $author $author }}
{{ end }}